{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="header">
        <h1>üß© Mot Fl√©ch√© Interactif</h1>
        <p>Uploadez votre fichier .xlsx Excel pour cr√©er votre mot fl√©ch√© interactif</p>
    </div>
    
    <div class="content">
        <div style="text-align: center; margin: 50px 0;">
            <div id="upload-area" style="
                border: 3px dashed #e86c1a;
                border-radius: 20px;
                padding: 60px 20px;
                background: #f8f9fa;
                transition: all 0.3s ease;
                cursor: pointer;
            ">
                <div style="font-size: 4em; margin-bottom: 20px;">üìÑ</div>
                <h3>Glissez-d√©posez votre fichier .xlsx ici</h3>
                <p style="color: #666; margin: 20px 0;">ou cliquez pour s√©lectionner un fichier</p>
                <input type="file" id="file-input" accept=".xlsx" style="display: none;">
                <div class="btn" >
<!--                    onclick="document.getElementById('file-input').click()"-->
                    üìÅ Choisir un fichier
                </div>
            </div>
            
            <div id="status" style="margin-top: 30px; font-size: 18px;"></div>
        </div>
        
        <div style="margin-top: 50px; padding: 30px; background: #f8f9fa; border-radius: 15px;">
            <h3 style="color: #333; margin-bottom: 20px;">üìã Instructions</h3>
            <ol style="line-height: 1.8; color: #555;">
                <li><strong>Cr√©ez votre grille</strong> dans Excel avec :
                    <ul style="margin: 10px 0 10px 30px;">
                        <li>Cases blanches pour les lettres √† remplir</li>
                        <li>Cases noires (fond noir) pour les s√©parateurs</li>
                        <li>Cases avec d√©finitions et fl√®ches (‚Üí pour horizontal, ‚Üì pour vertical)</li>
                    </ul>
                </li>
                <li><strong>Uploadez le fichier .xlsx</strong> en utilisant le formulaire ci-dessus</li>
                <li><strong>Partagez le lien</strong> g√©n√©r√©</li>
            </ol>
            
            <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border-radius: 10px; border-left: 5px solid #2196F3;">
                <h4 style="color: #1565C0; margin-bottom: 15px;">üí° Conseils pour une meilleure d√©tection</h4>
                <ul style="color: #0277BD; line-height: 1.6;">
                    <li>Utilisez des fl√®ches Unicode : ‚Üí (Alt+26) pour horizontal, ‚Üì (Alt+25) pour vertical</li>
                    <li>Placez les d√©finitions dans les cases noires adjacentes aux mots</li>
                    <li>Num√©rotez vos d√©finitions pour une meilleure organisation</li>
                    <li>√âvitez les cellules fusionn√©es complexes</li>
                    <li>D√©limitez votre grille en mettant des '#' √† l'ext√©rieur</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('file-input');
const status = document.getElementById('status');

// Drag & drop functionality
uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = '#e87527';
    uploadArea.style.background = '#f29455';
});

uploadArea.addEventListener('dragleave', (e) => {
    uploadArea.style.borderColor = '#e86c1a';
    uploadArea.style.background = '#f8f9fa';
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = '#e86c1a';
    uploadArea.style.background = '#f8f9fa';
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        handleFile(files[0]);
    }
});

uploadArea.addEventListener('click', () => {
    fileInput.click();
});

fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
    }
});

function handleFile(file) {
    showStatus('üì§ Upload en cours...', 'info');
    
    const formData = new FormData();
    formData.append('file', file);
    
    fetch('/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showStatus('‚úÖ Fichier trait√© avec succ√®s ! Redirection...', 'success');
            setTimeout(() => {
                window.location.href = data.redirect;
            }, 1500);
        } else {
            showStatus('‚ùå ' + data.error, 'error');
        }
    })
    .catch(error => {
        showStatus('‚ùå Erreur lors de l\'upload: ' + error.message, 'error');
    });
}

function showStatus(message, type) {
    status.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
}
</script>
{% endblock %}